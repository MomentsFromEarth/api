# Javascript Node CircleCI 2.1 configuration file
#
# Check https://circleci.com/docs/2.0/language-javascript/ for more details
#

version: 2.1

orbs:
  aws-cli: circleci/aws-cli@1.1.0

jobs:
  build:
    context: aws
    docker:
      - image: 'circleci/node:latest'

    working_directory: ~/api
    executor: aws-cli/default

    steps:
      - checkout
      # - run:
       #   name: Install dependencies
       #   command: sudo apt-get install python-dev && sudo apt-get install python-pip && sudo pip install awscli
      - aws-cli/configure:
          profile-name: circle-ci
          aws-access-key-id: AWS_ACCESS_KEY_ID
          aws-secret-access-key: AWS_SECRET_ACCESS_KEY
          aws-region: AWS_REGION
      - run: aws --version
      - run: ./build.sh
      - deploy:
          name: Deploy to AWS Lambda
          command: |
            if [ "${CIRCLE_BRANCH}" == "master" ]; then
              ./deploy.sh
            else
              echo "Not master branch so not deploying MFE API to AWS Lambda"
            fi
